## Vite + TS 实现 2D 渲染引擎

- 第一步：编写应用入口 Application 类
- 第二步：添加定时器 Timer 类
- 第三步：封装常用绘制图形方法

### 坐标系
[0, 0]---------------------------> +x
|
|             -90°
|              |
|    ±180° ----|---- 0°
|              |
|              |
|             90°
|
|
↓
+y
### 优化策略
- 一般来说，60fps的帧率，如果每帧需要执行2000次以上，也就是十万次以上才考虑优化
- 当执行太多的函数调用后，你会发现性能变得很慢。每当我减少一些函数调用（把函数中的代码直接拷贝到当前调用位置），性能都会有提升。
    ```js
    // 如果在主循环中有如下代码
    // bad ❌
    matrix1.append(matrix2)

    // good ✅
    matrix1.a = matrix2.a * matrix1.a + matrix2.b * matrix1.c;
    // ...
    ```
- 减少作用域链的查询；多次访问对象属性（甚至循环调用），建议先把该属性保存到一个局部变量中，再使用
    ```js
    // bad ❌
    var array = [];
    function getName() {
        array[0] = 0;
        array[1] = 0;
        array[2] = 0;
        array[3] = 0;
        // ...
    }

    // good ✅
    var array = [];
    function getName() {
        var array = array;
        array[0] = 0;
        array[1] = 0;
        array[2] = 0;
        array[3] = 0;
        // ...
    }

    ```
- js的四则运算中，除法是最慢的，乘法其次。Math封装的数学函数中，sin与cos函数执行是最慢的。
    ```js 
    // a 在大部分情况下为0
    
    // bad ❌
    c = a * b;
    f = a * e;

    // good ✅
    if(a == 0) {
        c = 0;
        f = 0;
    } else {
        c = a * b;
        f = a * e;
    }
    ```
    尽量避免不必要的乘除运算，可能的情况下，缓存sin和cos运算结果。pixi.js中，显示对象的旋转要用到三角函数计算，引擎内部进行了标脏处理。egret中，对全局的三角函数计算方法进行了查表优化。

总结来看，这些所谓的性能优化点，大部分都是js语言在运行过程中的弱点，在其它语言中未必会重现。例如，上文提到的函数调用，在c++等语言中并不会对性能造成明显影响。
    
### 问答
- 求任给多边形的面积（多边形给出了每个定点坐标）
    答：先把所有的多边形分解成多个三角形，然后只要能求出三角形面积，问题就解决了。

- 三角形的面积
    答：向量叉乘的模长 / 2

- 如何判断一个三角形的顶点顺序

- 点在三角形内部
    答：面积法、内角和法、重心法、同侧法、同侧法扩展（向量两两相叉乘符号一致）。
    重心法：P = A +  u * (C – A) + v * (B - A) （u >= 0，v >= 0，u + v <= 1）
    同侧法：假设点P位于三角形内，会有这样一个规律，当我们沿着ABCA的方向在三条边上行走时，你会发现点P始终位于边AB，BC和CA的右侧。我们就利用这一点，但是如何判断一个点在线段的左侧还是右侧呢？我们可以从另一个角度来思考，当选定线段AB时，点C位于AB的右侧，同理选定BC时，点A位于BC的右侧，最后选定CA时，点B位于CA的右侧，所以当选择某一条边时，我们只需验证点P与该边所对的点在同一侧即可。

- 如何判断某两个点在某条直线的同一侧
    答：叉乘以及右手螺旋定则，叉乘结果符号相同则位于同一侧